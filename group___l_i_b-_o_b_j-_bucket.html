<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DTS Application Library: Hashed bucket linked lists of referenced objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DTS Application Library
   &#160;<span id="projectnumber">0.2.3</span>
   </div>
   <div id="projectbrief">Application library containing referenced objects and interfaces to common libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___l_i_b-_o_b_j-_bucket.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Hashed bucket linked lists of referenced objects</div>  </div>
<div class="ingroups"><a class="el" href="group___l_i_b-_o_b_j.html">Referenced Lockable Objects</a></div></div><!--header-->
<div class="contents">

<p>Store references in and retrive from linked lists based on a hash.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:refobj_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refobj_8c.html">refobj.c</a></td></tr>
<tr class="memdesc:refobj_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Referenced Lockable Objects. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structblist__obj.html">blist_obj</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Entry in a bucket list.  <a href="structblist__obj.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbucket__list.html">bucket_list</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bucket list, hold hashed objects in buckets.  <a href="structbucket__list.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbucket__loop.html">bucket_loop</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bucket iterator.  <a href="structbucket__loop.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gabf1358cda7e434b44a959039e6fabfce"><td class="memItemLeft" align="right" valign="top">typedef int32_t(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gabf1358cda7e434b44a959039e6fabfce">blisthash</a> )(const void *, int)</td></tr>
<tr class="memdesc:gabf1358cda7e434b44a959039e6fabfce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to calculate the hash of a structure.  <a href="#gabf1358cda7e434b44a959039e6fabfce"></a><br/></td></tr>
<tr class="separator:gabf1358cda7e434b44a959039e6fabfce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35996929b1a3aae886be2e45d1cadfec"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga35996929b1a3aae886be2e45d1cadfec">blist_cb</a> )(void *, void *)</td></tr>
<tr class="memdesc:ga35996929b1a3aae886be2e45d1cadfec"><td class="mdescLeft">&#160;</td><td class="mdescRight">This callback is run on each entry in a list.  <a href="#ga35996929b1a3aae886be2e45d1cadfec"></a><br/></td></tr>
<tr class="separator:ga35996929b1a3aae886be2e45d1cadfec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga504545b538666017fe0d41e428310341"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga504545b538666017fe0d41e428310341">create_bucketlist</a> (int bitmask, <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gabf1358cda7e434b44a959039e6fabfce">blisthash</a> hash_function)</td></tr>
<tr class="separator:ga504545b538666017fe0d41e428310341"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga63890af5b9f14017f9face6f7255a955"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga63890af5b9f14017f9face6f7255a955">addtobucket</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist, void *data)</td></tr>
<tr class="memdesc:ga63890af5b9f14017f9face6f7255a955"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a reference to the bucketlist.  <a href="#ga63890af5b9f14017f9face6f7255a955"></a><br/></td></tr>
<tr class="separator:ga63890af5b9f14017f9face6f7255a955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga610e2d3a459838f394de26e8d1320253"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga610e2d3a459838f394de26e8d1320253">remove_bucket_item</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist, void *data)</td></tr>
<tr class="memdesc:ga610e2d3a459838f394de26e8d1320253"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove and unreference a item from the list.  <a href="#ga610e2d3a459838f394de26e8d1320253"></a><br/></td></tr>
<tr class="separator:ga610e2d3a459838f394de26e8d1320253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf312a26de37ad9594212c466a706c776"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaf312a26de37ad9594212c466a706c776">bucket_list_cnt</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist)</td></tr>
<tr class="memdesc:gaf312a26de37ad9594212c466a706c776"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return number of items in the list.  <a href="#gaf312a26de37ad9594212c466a706c776"></a><br/></td></tr>
<tr class="separator:gaf312a26de37ad9594212c466a706c776"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadcbb1534c836ba15aa2acf066bd5fff7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gadcbb1534c836ba15aa2acf066bd5fff7">bucket_list_find_key</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist, const void *key)</td></tr>
<tr class="memdesc:gadcbb1534c836ba15aa2acf066bd5fff7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find and return a reference to a item matching supplied key.  <a href="#gadcbb1534c836ba15aa2acf066bd5fff7"></a><br/></td></tr>
<tr class="separator:gadcbb1534c836ba15aa2acf066bd5fff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55c344ef8eb37a0a76eac1de01d36349"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga55c344ef8eb37a0a76eac1de01d36349">bucketlist_callback</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist, <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga35996929b1a3aae886be2e45d1cadfec">blist_cb</a> callback, void *data2)</td></tr>
<tr class="memdesc:ga55c344ef8eb37a0a76eac1de01d36349"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run a callback function on all items in the list.  <a href="#ga55c344ef8eb37a0a76eac1de01d36349"></a><br/></td></tr>
<tr class="separator:ga55c344ef8eb37a0a76eac1de01d36349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf05994d11e28a40271f80db3f3668852"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbucket__loop.html">bucket_loop</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaf05994d11e28a40271f80db3f3668852">init_bucket_loop</a> (struct <a class="el" href="structbucket__list.html">bucket_list</a> *blist)</td></tr>
<tr class="memdesc:gaf05994d11e28a40271f80db3f3668852"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a bucket list iterator to safely iterate the list.  <a href="#gaf05994d11e28a40271f80db3f3668852"></a><br/></td></tr>
<tr class="separator:gaf05994d11e28a40271f80db3f3668852"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4dfa18d64062aae420d9d7ab1c9943d7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga4dfa18d64062aae420d9d7ab1c9943d7">next_bucket_loop</a> (struct <a class="el" href="structbucket__loop.html">bucket_loop</a> *bloop)</td></tr>
<tr class="memdesc:ga4dfa18d64062aae420d9d7ab1c9943d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a reference to the next item in the list this could be the first item.  <a href="#ga4dfa18d64062aae420d9d7ab1c9943d7"></a><br/></td></tr>
<tr class="separator:ga4dfa18d64062aae420d9d7ab1c9943d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaab57f98566f9886d20cfa6229bd163a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaab57f98566f9886d20cfa6229bd163a0">remove_bucket_loop</a> (struct <a class="el" href="structbucket__loop.html">bucket_loop</a> *bloop)</td></tr>
<tr class="memdesc:gaab57f98566f9886d20cfa6229bd163a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Safely remove a item from a list while iterating in a loop.  <a href="#gaab57f98566f9886d20cfa6229bd163a0"></a><br/></td></tr>
<tr class="separator:gaab57f98566f9886d20cfa6229bd163a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Store references in and retrive from linked lists based on a hash. </p>
<p>Create a hashed bucket list.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="blists.html">Hashed Bucket Lists</a> </dd>
<dd>
<a class="el" href="group___l_i_b-_hash.html">Burtle Bob hash algorythim.</a></dd></dl>
<p>A bucket list is a ref obj the "list" element is a array of "bucket" entries each has a hash the default is to hash the memory when there is no call back </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>Dont hash the memory supply a key perhaps a key array type. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>the hash must be calculated on immutable data. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>a bucket list should only contain objects of the same type. </dd>
<dd>
Unreferencing the bucketlist will cause it to be emptied and freed when the count reaches 0. </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gabf1358cda7e434b44a959039e6fabfce" title="Callback used to calculate the hash of a structure.">blisthash</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bitmask</td><td>Number of buckets to create 2^bitmask. </td></tr>
    <tr><td class="paramname">hash_function</td><td>Callback that returns the unique hash for a item this value must not change. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Reference to a empty bucket list. </dd></dl>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga35996929b1a3aae886be2e45d1cadfec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* blist_cb)(void *, void *)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This callback is run on each entry in a list. </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga55c344ef8eb37a0a76eac1de01d36349" title="Run a callback function on all items in the list.">bucketlist_callback()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Reference held by the list. </td></tr>
    <tr><td class="paramname">data2</td><td>Reference to data supplied when calling bucketlist_callback. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dtsapp_8h_source.html#l00278">278</a> of file <a class="el" href="dtsapp_8h_source.html">dtsapp.h</a>.</p>

</div>
</div>
<a class="anchor" id="gabf1358cda7e434b44a959039e6fabfce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int32_t(* blisthash)(const void *, int)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback used to calculate the hash of a structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Data or key to calculate hash from. </td></tr>
    <tr><td class="paramname">key</td><td>Key if set to non zero data supplied is the key not data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Hash for the Reference. </dd></dl>

<p>Definition at line <a class="el" href="dtsapp_8h_source.html#l00271">271</a> of file <a class="el" href="dtsapp_8h_source.html">dtsapp.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga63890af5b9f14017f9face6f7255a955"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addtobucket </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a reference to the bucketlist. </p>
<p>Create a entry in the list for reference obtained from data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to add too. </td></tr>
    <tr><td class="paramname">data</td><td>to obtain a reference too and add to the list. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure 1 on success. </dd></dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00428">428</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, <a class="el" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e">bucket_list::count</a>, <a class="el" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08">ref_obj::data</a>, <a class="el" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f">blist_obj::data</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96">blist_obj::next</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3">objlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b">objref()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008">objunlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9">objunref()</a>, <a class="el" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a">blist_obj::prev</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga0fbd2bea995f35a552a2a502e1119977">refobj_offset</a>, and <a class="el" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea">bucket_list::version</a>.</p>

<p>Referenced by <a class="el" href="openldap_8c.html#a26a8931da9bb76eeaa25f320622ccf3f">_dtsldapsearch()</a>, <a class="el" href="group___l_i_b-_r_a_d_i_u_s.html#ga82fdb4e06174c84d7fe8c28f5d903dd4">add_radserver()</a>, <a class="el" href="group___l_i_b-_thread.html#ga810e4f7679b9091b76c1976ea1e56371">framework_mkthread()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#ga7dbeb9280e11b1b65574494a2fc01160">process_config()</a>, <a class="el" href="group___l_i_b-_n_a_t6.html#ga6c761d18183be3df327a2a1d9bc0bfa9">rfc6296_map_add()</a>, and <a class="el" href="group___l_i_b-_x_s_l_t.html#ga734f1d4ec878a7ae1a50576ee91eef90">xslt_addparam()</a>.</p>
<div class="fragment"><div class="line">                                                              {</div>
<div class="line">    <span class="keywordtype">char</span> *ptr = <a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structref__obj.html" title="Internal structure of all referenced objects.">ref_obj</a> *ref;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structblist__obj.html" title="Entry in a bucket list.">blist_obj</a> *lhead, *tmp;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a>, bucket;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b" title="Reference a object.">objref</a>(blist)) {</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b" title="Reference a object.">objref</a>(<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>)) {</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(blist);</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ptr = ptr - <a class="code" href="group___l_i_b-_o_b_j.html#ga0fbd2bea995f35a552a2a502e1119977" title="The size of ref_obj is the offset for the data.">refobj_offset</a>;</div>
<div class="line">    ref = (<span class="keyword">struct </span><a class="code" href="structref__obj.html" title="Internal structure of all referenced objects.">ref_obj</a> *)ptr;</div>
<div class="line"></div>
<div class="line">    hash = gethash(blist, <a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>, 0);</div>
<div class="line">    bucket = ((hash &gt;&gt; (32 - blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>)) &amp; ((1 &lt;&lt; blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>) - 1));</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">    lhead = blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket];</div>
<div class="line">    <span class="comment">/*no head or non null head*/</span></div>
<div class="line">    <span class="keywordflow">if</span> (!lhead || lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (!(tmp = malloc(<span class="keyword">sizeof</span>(*tmp)))) {</div>
<div class="line">            pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">            <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">            <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(blist);</div>
<div class="line">            <span class="keywordflow">return</span> (0);</div>
<div class="line">        }</div>
<div class="line">        memset(tmp, 0, <span class="keyword">sizeof</span>(*tmp));</div>
<div class="line">        tmp-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> = hash;</div>
<div class="line">        tmp-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a> = ref;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*there is no head*/</span></div>
<div class="line">        <span class="keywordflow">if</span> (!lhead) {</div>
<div class="line">            blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = tmp;</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = tmp;</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = NULL;</div>
<div class="line">        <span class="comment">/*become new head*/</span></div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hash &lt; lhead-&gt;hash) {</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = lhead;</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">            lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = tmp;</div>
<div class="line">            blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = tmp;</div>
<div class="line">        <span class="comment">/*new tail*/</span></div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hash &gt; lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a>) {</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = NULL;</div>
<div class="line">            lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = tmp;</div>
<div class="line">            lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = tmp;</div>
<div class="line">        <span class="comment">/*insert entry*/</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            lhead = blist_gotohash(lhead, hash, blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>);</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = lhead-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">            tmp-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = lhead;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (lhead-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>) {</div>
<div class="line">                lhead-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = tmp;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket]-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = tmp;</div>
<div class="line">            }</div>
<div class="line">            lhead-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = tmp;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">/*set NULL head*/</span></div>
<div class="line">        lhead-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a> = ref;</div>
<div class="line">        lhead-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = lhead;</div>
<div class="line">        lhead-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = NULL;</div>
<div class="line">        lhead-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> = hash;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[bucket]++;</div>
<div class="line">    pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3" title="Lock the reference.">objlock</a>(blist);</div>
<div class="line">    blist-&gt;<a class="code" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e" title="Number of items held.">count</a>++;</div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008" title="Unlock a reference.">objunlock</a>(blist);</div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(blist);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (1);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf312a26de37ad9594212c466a706c776"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bucket_list_cnt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return number of items in the list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to get count of. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Total number of items in all buckets. </dd></dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00552">552</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e">bucket_list::count</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3">objlock()</a>, and <a class="el" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008">objunlock()</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_r_a_d_i_u_s.html#ga82fdb4e06174c84d7fe8c28f5d903dd4">add_radserver()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#gafb3a53624d50c15f8660fd5e310bfe07">ldap_doadd()</a>, and <a class="el" href="group___l_i_b-_l_d_a_p.html#ga879a8a9934154de3e8ea1613ebc82ac1">ldap_domodify()</a>.</p>
<div class="fragment"><div class="line">                                                      {</div>
<div class="line">    <span class="keywordtype">int</span> ret = -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (blist) {</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3" title="Lock the reference.">objlock</a>(blist);</div>
<div class="line">        ret = blist-&gt;<a class="code" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e" title="Number of items held.">count</a>;</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008" title="Unlock a reference.">objunlock</a>(blist);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (ret);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gadcbb1534c836ba15aa2acf066bd5fff7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* bucket_list_find_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find and return a reference to a item matching supplied key. </p>
<p>The key is supplied to the hash callback ad the data value and the key flag set. The hash for the object will be returned by the hash callback to find the item in the lists. </p>
<dl class="section note"><dt>Note</dt><dd>if the hash is not calculated equal to the original value it wont be found. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to search. </td></tr>
    <tr><td class="paramname">key</td><td>Supplied to hash callback to find the item. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>New reference to the found item that needs to be unreferenced or NULL. </dd></dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00572">572</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, <a class="el" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08">ref_obj::data</a>, <a class="el" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f">blist_obj::data</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b">objref()</a>, and <a class="el" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9">objunref()</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_i_n_i.html#ga86c44d5b975637cbf0a84e034a4c3d1e">get_config_category()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#gaa0c111f840cf2b807ec54b42f7c9e89b">get_config_entry()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#gaa3e89f20af266ba0c27f389645246390">get_config_file()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#ga5d104d700aaff6de5e33167eb9510ea5">ldap_getattr()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#ga153ea0b02a17531dfd8ed40b32126841">ldap_getentry()</a>, <a class="el" href="group___l_i_b-_n_f-_q.html#ga6a52ad68b657707bb0657a76e1db96ed">nfqueue_attach()</a>, <a class="el" href="group___l_i_b-_x_m_l.html#ga63131b697dd2e587e1ce57a0bdefc23c">xml_getattr()</a>, and <a class="el" href="group___l_i_b-_x_m_l.html#ga6556cc28dbd3724698be265d1127eaf6">xml_getnode()</a>.</p>
<div class="fragment"><div class="line">                                                                              {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structblist__obj.html" title="Entry in a bucket list.">blist_obj</a> *entry;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a>, bucket;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!blist) {</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    hash = gethash(blist, key, 1);</div>
<div class="line">    bucket = ((hash &gt;&gt; (32 - blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>)) &amp; ((1 &lt;&lt; blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>) - 1));</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">    entry = blist_gotohash(blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket], hash + 1, blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (entry &amp;&amp; entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>) {</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b" title="Reference a object.">objref</a>(entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">    } <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">if</span> (!entry) {</div>
<div class="line">            pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a> &amp;&amp; (entry-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> == hash)) {</div>
<div class="line">        <span class="keywordflow">return</span> (entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">    } <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>) {</div>
<div class="line">            <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga55c344ef8eb37a0a76eac1de01d36349"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bucketlist_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga35996929b1a3aae886be2e45d1cadfec">blist_cb</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run a callback function on all items in the list. </p>
<p>This will iterate safely through all items calling the callback with the item and the optional data supplied. </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga35996929b1a3aae886be2e45d1cadfec" title="This callback is run on each entry in a list.">blist_cb</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to iterate through. </td></tr>
    <tr><td class="paramname">callback</td><td>Callback to call for each iteration. </td></tr>
    <tr><td class="paramname">data2</td><td>Data to be set as option to the callback. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00613">613</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaf05994d11e28a40271f80db3f3668852">init_bucket_loop()</a>, <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga4dfa18d64062aae420d9d7ab1c9943d7">next_bucket_loop()</a>, and <a class="el" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9">objunref()</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_i_n_i.html#ga05d72d8b45f4c0838f417923a0ce8f06">config_cat_callback()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#gadc8b44af6ff37b8f84d8ce70a3c0f85b">config_entry_callback()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#ga2d71de953de42dd2d90d20a3a5467c47">config_file_callback()</a>, and <a class="el" href="group___l_i_b-_n_a_t6.html#ga05d6c7b8c8759920bf5103742987f7a6">rfc6296_test()</a>.</p>
<div class="fragment"><div class="line">                                                                                           {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structbucket__loop.html" title="Bucket iterator.">bucket_loop</a> *bloop;</div>
<div class="line">    <span class="keywordtype">void</span> *data;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!blist || !callback) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    bloop = <a class="code" href="group___l_i_b-_o_b_j-_bucket.html#gaf05994d11e28a40271f80db3f3668852" title="Create a bucket list iterator to safely iterate the list.">init_bucket_loop</a>(blist);</div>
<div class="line">    <span class="keywordflow">while</span>(blist &amp;&amp; bloop &amp;&amp; (data = <a class="code" href="group___l_i_b-_o_b_j-_bucket.html#ga4dfa18d64062aae420d9d7ab1c9943d7" title="Return a reference to the next item in the list this could be the first item.">next_bucket_loop</a>(bloop))) {</div>
<div class="line">        callback(data, data2);</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(data);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(bloop);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga504545b538666017fe0d41e428310341"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* create_bucketlist </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bitmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gabf1358cda7e434b44a959039e6fabfce">blisthash</a>&#160;</td>
          <td class="paramname"><em>hash_function</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00356">356</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, and <a class="el" href="group___l_i_b-_o_b_j.html#ga21cf8972a38aed3f153f4ed06b12a419">objalloc()</a>.</p>

<p>Referenced by <a class="el" href="openldap_8c.html#a26a8931da9bb76eeaa25f320622ccf3f">_dtsldapsearch()</a>, <a class="el" href="group___l_i_b-_r_a_d_i_u_s.html#ga82fdb4e06174c84d7fe8c28f5d903dd4">add_radserver()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#gafce6d8814b3bdf793cabb6fcc2f79833">ldap_addinit()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#ga9abb041462703514fe1ed59a071bf688">ldap_modifyinit()</a>, <a class="el" href="group___l_i_b-_n_a_t6.html#ga6c761d18183be3df327a2a1d9bc0bfa9">rfc6296_map_add()</a>, <a class="el" href="group___l_i_b-_sock.html#ga4c08ae54e4e2d9ae7fa2f3a3a17a2e81">socketserver()</a>, <a class="el" href="group___l_i_b-_thread.html#ga5196903ef5e3e656b28c52e045f7c3f3">startthreads()</a>, <a class="el" href="group___l_i_b-_x_s_l_t.html#ga8fb842b8c9126530b5f1da64c388c443">xslt_clearparam()</a>, and <a class="el" href="group___l_i_b-_x_s_l_t.html#gae4e57cd34418965c1fb559cee95c4496">xslt_open()</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structbucket__list.html" title="Bucket list, hold hashed objects in buckets.">bucket_list</a> *<span class="keyword">new</span>;</div>
<div class="line">    <span class="keywordtype">short</span> <span class="keywordtype">int</span> buckets, cnt;</div>
<div class="line"></div>
<div class="line">    buckets = (1 &lt;&lt; bitmask);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* allocate session bucket list memory size of the struct plus a list lock and version for each bucket*/</span></div>
<div class="line">    <span class="keywordflow">if</span> (!(<span class="keyword">new</span> = <a class="code" href="group___l_i_b-_o_b_j.html#ga21cf8972a38aed3f153f4ed06b12a419" title="Allocate a referenced lockable object.">objalloc</a>(<span class="keyword">sizeof</span>(*<span class="keyword">new</span>) + (<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) + <span class="keyword">sizeof</span>(pthread_mutex_t) + <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)) * buckets, empty_buckets))) {</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*initialise each bucket*/</span></div>
<div class="line">    <span class="keyword">new</span>-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a> = bitmask;</div>
<div class="line">    <span class="keyword">new</span>-&gt;list = (<span class="keywordtype">void</span> *)((<span class="keywordtype">char</span> *)<span class="keyword">new</span> + <span class="keyword">sizeof</span>(*new));</div>
<div class="line">    <span class="keywordflow">for</span> (cnt = 0; cnt &lt; buckets; cnt++) {</div>
<div class="line">        <span class="keywordflow">if</span> ((new-&gt;list[cnt] = malloc(<span class="keyword">sizeof</span>(*new-&gt;list[cnt])))) {</div>
<div class="line">            memset(new-&gt;list[cnt], 0, <span class="keyword">sizeof</span>(*new-&gt;list[cnt]));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*next pointer is pointer to locks*/</span></div>
<div class="line">    <span class="keyword">new</span>-&gt;locks = (<span class="keywordtype">void</span> *)&amp;new-&gt;list[buckets];</div>
<div class="line">    for (cnt = 0; cnt &lt; buckets; cnt++) {</div>
<div class="line">        pthread_mutex_init(&amp;new-&gt;locks[cnt], NULL);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*Next up version array*/</span></div>
<div class="line">    <span class="keyword">new</span>-&gt;version = (<span class="keywordtype">void</span> *)&amp;new-&gt;locks[buckets];</div>
<div class="line"></div>
<div class="line">    new-&gt;hash_func = hash_function;</div>
<div class="line"></div>
<div class="line">    return (<span class="keyword">new</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf05994d11e28a40271f80db3f3668852"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbucket__loop.html">bucket_loop</a>* init_bucket_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a bucket list iterator to safely iterate the list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to create iterator for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bucket list iterator that needs to be unreferenced when completed. </dd></dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00640">640</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3">bucket_loop::blist</a>, <a class="el" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40">bucket_loop::bucket</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76">bucket_loop::head</a>, <a class="el" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a">bucket_loop::head_hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga21cf8972a38aed3f153f4ed06b12a419">objalloc()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b">objref()</a>, <a class="el" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea">bucket_list::version</a>, and <a class="el" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb">bucket_loop::version</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga55c344ef8eb37a0a76eac1de01d36349">bucketlist_callback()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#ga9f9a4e6930756767fd89ceda044e0c3d">get_category_loop()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#gafb3a53624d50c15f8660fd5e310bfe07">ldap_doadd()</a>, and <a class="el" href="group___l_i_b-_l_d_a_p.html#ga879a8a9934154de3e8ea1613ebc82ac1">ldap_domodify()</a>.</p>
<div class="fragment"><div class="line">                                                                       {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structbucket__loop.html" title="Bucket iterator.">bucket_loop</a> *bloop = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (blist &amp;&amp; (bloop = <a class="code" href="group___l_i_b-_o_b_j.html#ga21cf8972a38aed3f153f4ed06b12a419" title="Allocate a referenced lockable object.">objalloc</a>(<span class="keyword">sizeof</span>(*bloop), free_bloop))) {</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b" title="Reference a object.">objref</a>(blist);</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3" title="Referenece to the bucket been itereated.">blist</a> = <a class="code" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3" title="Referenece to the bucket been itereated.">blist</a>;</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a> = 0;</div>
<div class="line">        pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> = blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[0];</div>
<div class="line">        <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>) {</div>
<div class="line">            bloop-&gt;<a class="code" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a" title="Hash of head if we need to comeback.">head_hash</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a>;</div>
<div class="line">        };</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb" title="Our version check this with blist to determine if we must rewined and fast forward.">version</a> = blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[0];</div>
<div class="line">        pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (bloop);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga4dfa18d64062aae420d9d7ab1c9943d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* next_bucket_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__loop.html">bucket_loop</a> *&#160;</td>
          <td class="paramname"><em>bloop</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a reference to the next item in the list this could be the first item. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bloop</td><td>Bucket iterator </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Next available item or NULL when there no items left </dd></dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00662">662</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3">bucket_loop::blist</a>, <a class="el" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40">bucket_loop::bucket</a>, <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, <a class="el" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1">bucket_loop::cur</a>, <a class="el" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5">bucket_loop::cur_hash</a>, <a class="el" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08">ref_obj::data</a>, <a class="el" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f">blist_obj::data</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76">bucket_loop::head</a>, <a class="el" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a">bucket_loop::head_hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96">blist_obj::next</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b">objref()</a>, <a class="el" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a">blist_obj::prev</a>, <a class="el" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea">bucket_list::version</a>, and <a class="el" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb">bucket_loop::version</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga55c344ef8eb37a0a76eac1de01d36349">bucketlist_callback()</a>, <a class="el" href="group___l_i_b-_i_n_i.html#gacda25f5961b62c5de343589c3a72b771">get_category_next()</a>, <a class="el" href="group___l_i_b-_l_d_a_p.html#gafb3a53624d50c15f8660fd5e310bfe07">ldap_doadd()</a>, and <a class="el" href="group___l_i_b-_l_d_a_p.html#ga879a8a9934154de3e8ea1613ebc82ac1">ldap_domodify()</a>.</p>
<div class="fragment"><div class="line">                                                         {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structbucket__list.html" title="Bucket list, hold hashed objects in buckets.">bucket_list</a> *blist = bloop-&gt;<a class="code" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3" title="Referenece to the bucket been itereated.">blist</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structref__obj.html" title="Internal structure of all referenced objects.">ref_obj</a> *entry = NULL;</div>
<div class="line">    <span class="keywordtype">void</span> *<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a> = NULL;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a" title="Hash of head if we need to comeback.">head_hash</a> &amp;&amp; (blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>] != bloop-&gt;<a class="code" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb" title="Our version check this with blist to determine if we must rewined and fast forward.">version</a>)) {</div>
<div class="line">        <span class="comment">/* bucket has changed unexpectedly i need to ff/rew to hash*/</span></div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> = blist_gotohash(blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>], bloop-&gt;<a class="code" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a" title="Hash of head if we need to comeback.">head_hash</a> + 1, blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>);</div>
<div class="line">        <span class="comment">/*if head has gone find next suitable ignore any added*/</span></div>
<div class="line">        <span class="keywordflow">while</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> &amp;&amp; (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> &lt; bloop-&gt;<a class="code" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a" title="Hash of head if we need to comeback.">head_hash</a>)) {</div>
<div class="line">            bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (!bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> || !bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>) {</div>
<div class="line">        pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>++;</div>
<div class="line">        <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a> &lt; (1 &lt;&lt; blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>)) {</div>
<div class="line">            pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">            bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> = blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>];</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>) {</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>;</div>
<div class="line">        entry = (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>) ? bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a> : NULL;</div>
<div class="line">        data = (entry) ? entry-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a> : NULL;</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga3a67a6d45e39f530beb6e45b6b7e7d3b" title="Reference a object.">objref</a>(data);</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a4e6ef15df0a3abd280bf6f04d4c2b95a" title="Hash of head if we need to comeback.">head_hash</a> = (bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>) ? bloop-&gt;<a class="code" href="structbucket__loop.html#a91dd157ebd0336f01305dba937d13b76" title="Current bucket.">head</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> : 0;</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5" title="Hash of cur if we need to comeback.">cur_hash</a> = (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>) ? bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> : 0;</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (data);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga610e2d3a459838f394de26e8d1320253"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void remove_bucket_item </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__list.html">bucket_list</a> *&#160;</td>
          <td class="paramname"><em>blist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove and unreference a item from the list. </p>
<dl class="section note"><dt>Note</dt><dd>Dont use this function directly during iteration as it imposes performance penalties. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blist</td><td>Bucket list to remove item from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaab57f98566f9886d20cfa6229bd163a0" title="Safely remove a item from a list while iterating in a loop.">remove_bucket_loop</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Reference to be removed and unreferenced. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00517">517</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, <a class="el" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e">bucket_list::count</a>, <a class="el" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08">ref_obj::data</a>, <a class="el" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f">blist_obj::data</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96">blist_obj::next</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3">objlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008">objunlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9">objunref()</a>, <a class="el" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a">blist_obj::prev</a>, and <a class="el" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea">bucket_list::version</a>.</p>

<p>Referenced by <a class="el" href="group___l_i_b-_l_d_a_p.html#ga9259d04f5cd09ec2bf0f96c904976f5e">ldap_unref_attr()</a>, and <a class="el" href="group___l_i_b-_l_d_a_p.html#ga293cb196f673abba19c663a64c0943f4">ldap_unref_entry()</a>.</p>
<div class="fragment"><div class="line">                                                                      {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structblist__obj.html" title="Entry in a bucket list.">blist_obj</a> *entry;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a>, bucket;</div>
<div class="line"></div>
<div class="line">    hash = gethash(blist, <a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>, 0);</div>
<div class="line">    bucket = ((hash &gt;&gt; (32 - blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>)) &amp; ((1 &lt;&lt; blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>) - 1));</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">    entry = blist_gotohash(blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket], hash + 1, blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (entry &amp;&amp; entry-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> == hash) {</div>
<div class="line">        <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> &amp;&amp; (entry == blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket])) {</div>
<div class="line">            entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = entry-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">            blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>) {</div>
<div class="line">            entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = entry-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">            entry-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = entry-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry == blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket]) {</div>
<div class="line">            blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = NULL;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            entry-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = NULL;</div>
<div class="line">            blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket]-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = entry-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(entry-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">        free(entry);</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3" title="Lock the reference.">objlock</a>(blist);</div>
<div class="line">        blist-&gt;<a class="code" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e" title="Number of items held.">count</a>--;</div>
<div class="line">        blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[bucket]++;</div>
<div class="line">        <a class="code" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008" title="Unlock a reference.">objunlock</a>(blist);</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaab57f98566f9886d20cfa6229bd163a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void remove_bucket_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbucket__loop.html">bucket_loop</a> *&#160;</td>
          <td class="paramname"><em>bloop</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Safely remove a item from a list while iterating in a loop. </p>
<p>While traversing the bucket list its best to use this function to remove a reference and delete it from the list. </p>
<dl class="section note"><dt>Note</dt><dd>Removeing a item from the list without using this function will cause the the version to change and the iterator to rewind and fast forward. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bloop</td><td>Bucket iterator. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="refobj_8c_source.html#l00710">710</a> of file <a class="el" href="refobj_8c_source.html">refobj.c</a>.</p>

<p>References <a class="el" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3">bucket_loop::blist</a>, <a class="el" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40">bucket_loop::bucket</a>, <a class="el" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893">bucket_list::bucketbits</a>, <a class="el" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e">bucket_list::count</a>, <a class="el" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1">bucket_loop::cur</a>, <a class="el" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5">bucket_loop::cur_hash</a>, <a class="el" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08">ref_obj::data</a>, <a class="el" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f">blist_obj::data</a>, <a class="el" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5">blist_obj::hash</a>, <a class="el" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c">bucket_list::list</a>, <a class="el" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5">bucket_list::locks</a>, <a class="el" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96">blist_obj::next</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3">objlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008">objunlock()</a>, <a class="el" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9">objunref()</a>, <a class="el" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a">blist_obj::prev</a>, <a class="el" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea">bucket_list::version</a>, and <a class="el" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb">bucket_loop::version</a>.</p>
<div class="fragment"><div class="line">                                                          {</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structbucket__list.html" title="Bucket list, hold hashed objects in buckets.">bucket_list</a> *blist = bloop-&gt;<a class="code" href="structbucket__loop.html#aa56b1e578b1d53f1a9c3a4b9abb694e3" title="Referenece to the bucket been itereated.">blist</a>;</div>
<div class="line">    <span class="keywordtype">int</span> bucket = bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>]);</div>
<div class="line">    <span class="comment">/*if the bucket has altered need to verify i can remove*/</span></div>
<div class="line">    <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5" title="Hash of cur if we need to comeback.">cur_hash</a> &amp;&amp; (!bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> || (blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>] != bloop-&gt;<a class="code" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb" title="Our version check this with blist to determine if we must rewined and fast forward.">version</a>))) {</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> = blist_gotohash(blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bloop-&gt;<a class="code" href="structbucket__loop.html#a5786da1ec8486c4293e2abf4fc554b40" title="Active bucket as determined by hash.">bucket</a>], bloop-&gt;<a class="code" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5" title="Hash of cur if we need to comeback.">cur_hash</a> + 1, blist-&gt;<a class="code" href="structbucket__list.html#a27d5a7bc37cf67aac5131f3ae21c1893" title="number of buckets 2^n">bucketbits</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (!bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> || (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a10e72984c2a9c6a3de07586c5d8a79c5" title="Hash value calculated from the data.">hash</a> != bloop-&gt;<a class="code" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5" title="Hash of cur if we need to comeback.">cur_hash</a>)) {</div>
<div class="line">            pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>) {</div>
<div class="line">        pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> &amp;&amp; (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> == blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket])) {</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">        blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>) {</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> == blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket]) {</div>
<div class="line">        blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket] = NULL;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>-&gt;<a class="code" href="structblist__obj.html#aa2ccd4f4869b457fcca8ada6042bdb96" title="Next entry in the bucket.">next</a> = NULL;</div>
<div class="line">        blist-&gt;<a class="code" href="structbucket__list.html#a39f6f08d43f8c26616cac2a37ae2856c" title="Array of blist_obj one per bucket ie 2^bucketbits.">list</a>[bucket]-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a> = bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a61ae75a0a5d05916a302d365e7ca470a" title="Previous entry in the bucket.">prev</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga88a966a194cdf36fe9b5be0917ce86d9" title="Drop reference held.">objunref</a>(bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>-&gt;<a class="code" href="structblist__obj.html#a6fa1ad5e6615e1e7fd15743800d9e78f" title="Reference to data held.">data</a>-&gt;<a class="code" href="structref__obj.html#a4725a0b14472b6571c3901ccc71bae08" title="Pointer to the data referenced.">data</a>);</div>
<div class="line">    free(bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a>);</div>
<div class="line">    bloop-&gt;<a class="code" href="structbucket__loop.html#a20c18d1924487b7918f2d9cee958ebc5" title="Hash of cur if we need to comeback.">cur_hash</a> = 0;</div>
<div class="line">    bloop-&gt;<a class="code" href="structbucket__loop.html#a25c4c5aefd932a39f8d444ef7cdd1fa1" title="Current item.">cur</a> = NULL;</div>
<div class="line">    blist-&gt;<a class="code" href="structbucket__list.html#a38a8dcfedb85da3556814085382f2bea" title="version of the bucket to detect changes during iteration (loop)">version</a>[bucket]++;</div>
<div class="line">    bloop-&gt;<a class="code" href="structbucket__loop.html#a490142bbc1e0b029834e8e2e5b548ecb" title="Our version check this with blist to determine if we must rewined and fast forward.">version</a>++;</div>
<div class="line">    pthread_mutex_unlock(&amp;blist-&gt;<a class="code" href="structbucket__list.html#a55970b0d3a70126a24caee83bd6889d5" title="Array of locks one per bucket.">locks</a>[bucket]);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga4af4ae14c4a3e9f3037a09237bcfeae3" title="Lock the reference.">objlock</a>(blist);</div>
<div class="line">    blist-&gt;<a class="code" href="structbucket__list.html#a59345370e4c9bbc627770d4b0b6aa30e" title="Number of items held.">count</a>--;</div>
<div class="line">    <a class="code" href="group___l_i_b-_o_b_j.html#ga8c73b68730aa4452357e84af27e00008" title="Unlock a reference.">objunlock</a>(blist);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 22 2013 23:26:32 for DTS Application Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>

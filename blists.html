<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DTS Application Library: Hashed Bucket Lists</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DTS Application Library
   &#160;<span id="projectnumber">0.2.3</span>
   </div>
   <div id="projectbrief">Application library containing referenced objects and interfaces to common libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('blists.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Hashed Bucket Lists </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The only method of creating the concept of a list is via an array these are not ideal and have the folowing downsides. </p>
<ul>
<li>The size of the array needs to be known ahead of time or it needs to be big enough and can be resized at a processing / memmory expense. </li>
<li>Inserting a value at a position involves resizing as above then moving all of the existing items over one at a time. </li>
<li>Removing elements from an array is either done in reverse to inserting or the item is NULL'd and left. </li>
<li>Requires locking the whole array in multithreaded applications not only a record/records.</li>
</ul>
<p>Arrays have the following upsides </p>
<ul>
<li>Elements can be accessed randomly if there position is known this is not so simple as the index is linear and can change on insertion/deletion. </li>
<li>As the elements are adjacent in memory accessing them sequntially is faster than non seqential access.</li>
</ul>
<p>The concept of the linked list was introduced to circumvent these downsides in its simplest form a structure will have a pointer of its data type called next initially this is null to add a element to the list you set the last element in the lists next pointer to the element adding while its next element is set to NULL</p>
<pre class="fragment">struct test {
    const char *name;
    struct test *next;
};


struct test a, b, c, *i;

a.name = "a";
a.next = NULL;

b.name = "b";
b.next = NULL;

c.name = "c";
c.next = NULL;

/*lets link em*/

a.next = &amp;b;
b.next = &amp;c;

for(i = &amp;a; i; i=i-&gt;next) {
    .....
}</pre><p>This shows the basic linked list and is effectivly equivilent as to interating through an array except for the loss of speed not been adjacent.</p>
<p>Double linked lists will have a prev pointer too that will allow traversal in any direction.</p>
<p>Looking at structure <a class="el" href="structblist__obj.html" title="Entry in a bucket list.">blist_obj</a> you can see the next/prev pointers in addition to a hash and data pointer that points to the data so any item can be linked without the item itself requireing next/prev pointers this is the storage of all bucket lists.</p>
<p>The reason they are bucket lists is that they have elements of both arrays and linked lists the bucket list is infact a array of linked lists see the <a class="el" href="structbucket__list.html" title="Bucket list, hold hashed objects in buckets.">bucket_list</a> structure.</p>
<p>The list is a array of 2^bucketbits these are the buckets so for 8192 elements using 6 bits will create 64 buckets if filled equally there will be 128 elements in each. this will allow better access to the chunk you want access too and allows for quicker more efficent traversal than traversing all 8192 elements.</p>
<p>Allocating the elements to a bucket is where the hash comes in each element will via some unique immutable "key" be hashed see <a class="el" href="group___l_i_b-_hash.html#ga12615157f39537cddeafef8a868079e7">jenhash()</a> this hash will be masked with the bucket bits to determine the bucket to be placed in they are then inserted basesd on there hash, this allows the algorythim to search forward or backward theortically only ever having to traverse 64 elements of 8192.</p>
<p>Using this hybrid approach gives us a good compromise and benifits of either method.</p>
<p>The big disadvantage is that the data needs to have some immutable element to be able to search with and does not afford the same random access that arrays do but far better than standard linked lists. In both these cases with most data having some unique key and machines been faster with faster memory they acceptable.</p>
<h1><a class="anchor" id="usage"></a>
Usage of hashed bucket lists</h1>
<p>Hashed bucket lists are easy to use they are created with a call to <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga504545b538666017fe0d41e428310341">create_bucketlist()</a> you will need a hash function to generate the hash if you want to use search by key function you need to accept both the data and the key and return the hash.</p>
<pre class="fragment">int32_t hash(const void *data, int key) {
    int ret = 0;

    /*cast the data to the correct structure*/
    struct form_item *fi = data;
    /*Return the data as the key if we searching key=1 or the name otherwise*/
    const char *hashkey = (key) ? (const char*)data : fi-&gt;name;

    ret = jenhash(hashkey, strlen(hashkey), 0);

    return(ret);
}</pre><p>Thats that folks use <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga63890af5b9f14017f9face6f7255a955" title="Add a reference to the bucketlist.">addtobucket()</a> to add a item to the list, <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga610e2d3a459838f394de26e8d1320253" title="Remove and unreference a item from the list.">remove_bucket_item()</a> to remove reference and <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaf312a26de37ad9594212c466a706c776" title="Return number of items in the list.">bucket_list_cnt()</a> to get number of elements in the list.</p>
<p>Searching the list can be done via iteration or by key using <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga55c344ef8eb37a0a76eac1de01d36349" title="Run a callback function on all items in the list.">bucketlist_callback()</a> and <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gadcbb1534c836ba15aa2acf066bd5fff7" title="Find and return a reference to a item matching supplied key.">bucket_list_find_key()</a> respectivly.</p>
<p>Too implement your own interator use <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaf05994d11e28a40271f80db3f3668852" title="Create a bucket list iterator to safely iterate the list.">init_bucket_loop()</a> <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#ga4dfa18d64062aae420d9d7ab1c9943d7" title="Return a reference to the next item in the list this could be the first item.">next_bucket_loop()</a> and <a class="el" href="group___l_i_b-_o_b_j-_bucket.html#gaab57f98566f9886d20cfa6229bd163a0" title="Safely remove a item from a list while iterating in a loop.">remove_bucket_loop()</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 23 2013 07:33:28 for DTS Application Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>

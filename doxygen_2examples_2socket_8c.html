<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>DTS Application Library: doxygen/examples/socket.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DTS Application Library
   &#160;<span id="projectnumber">0.2.3</span>
   </div>
   <div id="projectbrief">Application library containing referenced objects and interfaces to common libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('doxygen_2examples_2socket_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">socket.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Echo server using 1 server and 2 clients.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;openssl/ssl.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="dtsapp_8h_source.html">dtsapp.h</a>&gt;</code><br/>
</div>
<p><a href="doxygen_2examples_2socket_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1a392138c00ec1b59dfdeefe903da96f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#a1a392138c00ec1b59dfdeefe903da96f">accept_func</a> (struct <a class="el" href="structfwsocket.html">fwsocket</a> *sock, void *data)</td></tr>
<tr class="memdesc:a1a392138c00ec1b59dfdeefe903da96f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does nothing and is here for completeness.  <a href="#a1a392138c00ec1b59dfdeefe903da96f">More...</a><br/></td></tr>
<tr class="separator:a1a392138c00ec1b59dfdeefe903da96f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8acb206590ded63f9e7b4d53f86ee511"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func</a> (struct <a class="el" href="structfwsocket.html">fwsocket</a> *sock, void *data)</td></tr>
<tr class="memdesc:a8acb206590ded63f9e7b4d53f86ee511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Server thread data is available.  <a href="#a8acb206590ded63f9e7b4d53f86ee511">More...</a><br/></td></tr>
<tr class="separator:a8acb206590ded63f9e7b4d53f86ee511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31a3fbb9110bf3db1a75cedc9b83f1f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a> (struct <a class="el" href="structfwsocket.html">fwsocket</a> *sock, void *data)</td></tr>
<tr class="memdesc:a31a3fbb9110bf3db1a75cedc9b83f1f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">client thread data is available.  <a href="#a31a3fbb9110bf3db1a75cedc9b83f1f5">More...</a><br/></td></tr>
<tr class="separator:a31a3fbb9110bf3db1a75cedc9b83f1f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ef6ea6c5a4ecf30b10d8b4243f0e22a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a> (const char *ipaddr, int tcp, int ssl)</td></tr>
<tr class="memdesc:a5ef6ea6c5a4ecf30b10d8b4243f0e22a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bassed on the options create server and clients.  <a href="#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">More...</a><br/></td></tr>
<tr class="separator:a5ef6ea6c5a4ecf30b10d8b4243f0e22a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d9bd0957879771fdd9a4c74673aeff6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest</a> (const char *socket, int protocol)</td></tr>
<tr class="memdesc:a9d9bd0957879771fdd9a4c74673aeff6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same test as for <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a" title="Bassed on the options create server and clients. ">socktest()</a> but for unix domain sockets.  <a href="#a9d9bd0957879771fdd9a4c74673aeff6">More...</a><br/></td></tr>
<tr class="separator:a9d9bd0957879771fdd9a4c74673aeff6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4d09807d002671ee7378fef2ee63a48"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="doxygen_2examples_2socket_8c.html#ad4d09807d002671ee7378fef2ee63a48">FRAMEWORK_MAIN</a> (&quot;Socket Client/Server Echo (TCP/TLS/UDP/DTLS)&quot;,&quot;Gregory Hinton Nietsky&quot;,&quot;gregory@distrotech.co.za&quot;,&quot;http://www.distrotech.co.za&quot;, 2013,&quot;/var/run/sockettest&quot;, FRAMEWORK_FLAG_DAEMONLOCK, NULL)</td></tr>
<tr class="memdesc:ad4d09807d002671ee7378fef2ee63a48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the application under the library replacing main()  <a href="#ad4d09807d002671ee7378fef2ee63a48">More...</a><br/></td></tr>
<tr class="separator:ad4d09807d002671ee7378fef2ee63a48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Echo server using 1 server and 2 clients. </p>
<p>Simple implementation of a echo server shoeing the network socket interface it creates 1 server and 2 client threads the server echos back what is sent. the sockets support ipv4 and ipv6 and can be UDP or TCP with or without TLS/SSL support.<br/>
On application start using FRAMEWORK_MAIN a licence banner is displayed no flags are set as i wish to daemonize after checking the command line arguments.<br/>
There is a run/lock file created failure to lock this file prevents execution.<br/>
Once the sockets are created and threads started i sleep the main thread for 5 seconds before exiting the system will make sure all threads stop before leaving.<br/>
As you can see the progam initiliztion and flow has been greatly simplified by having these tasks managed. </p>

<p>Definition in file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a1a392138c00ec1b59dfdeefe903da96f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void accept_func </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfwsocket.html">fwsocket</a> *&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does nothing and is here for completeness. </p>
<p>When a new connection is recieved this function will be executed to allow processing of the connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>Reference to new socket </td></tr>
    <tr><td class="paramname">data</td><td>Reference to data suppled on thread start </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a0">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00036">36</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                                                    {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a31a3fbb9110bf3db1a75cedc9b83f1f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void client_func </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfwsocket.html">fwsocket</a> *&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>client thread data is available. </p>
<p>There is no need to worry about UDP support in client trhead callbacks and use of socketread / socketwrite is all that is required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>Reference to socket data is available on. </td></tr>
    <tr><td class="paramname">data</td><td>Reference to data held by thread. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a7">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00066">66</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">fwsocket::sock</a>, <a class="el" href="group___l_i_b-_sock.html#gaf3ef7463540bad28e11d21496458e767">socketread()</a>, and <a class="el" href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite()</a>.</p>

<p>Referenced by <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest()</a>, and <a class="el" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                                    {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structzobj.html#a317b290945d079ccbe036e8c41c45668">buff</a>[128];</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___l_i_b-_sock.html#gaf3ef7463540bad28e11d21496458e767">socketread</a>(sock, &amp;buff, 128) &gt; 0) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite</a>(sock, &amp;buff, strlen(buff) + 1);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        printf(<span class="stringliteral">&quot;[C] %s %i\n&quot;</span>, buff, sock-&gt;<a class="code" href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">sock</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="ttc" id="group___l_i_b-_sock_html_gaf3ef7463540bad28e11d21496458e767"><div class="ttname"><a href="group___l_i_b-_sock.html#gaf3ef7463540bad28e11d21496458e767">socketread</a></div><div class="ttdeci">int socketread(struct fwsocket *sock, void *buf, int num)</div><div class="ttdoc">Read from a socket into a buffer. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00489">sslutil.c:489</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga083df40554507cfc277fb699c10a17ec"><div class="ttname"><a href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite</a></div><div class="ttdeci">int socketwrite(struct fwsocket *sock, const void *buf, int num)</div><div class="ttdoc">Write a buffer to a socket. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00629">sslutil.c:629</a></div></div>
<div class="ttc" id="structfwsocket_html_aa08a6630d5f365c9d02702ae105d0508"><div class="ttname"><a href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">fwsocket::sock</a></div><div class="ttdeci">int sock</div><div class="ttdoc">Socket FD. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00133">dtsapp.h:133</a></div></div>
<div class="ttc" id="structzobj_html_a317b290945d079ccbe036e8c41c45668"><div class="ttname"><a href="structzobj.html#a317b290945d079ccbe036e8c41c45668">zobj::buff</a></div><div class="ttdeci">uint8_t * buff</div><div class="ttdoc">Buffer with compressed/uncompressed data. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00166">dtsapp.h:166</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad4d09807d002671ee7378fef2ee63a48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FRAMEWORK_MAIN </td>
          <td>(</td>
          <td class="paramtype">&quot;Socket Client/Server Echo (TCP/TLS/UDP/DTLS)&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Gregory Hinton Nietsky&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;gregory@distrotech.co.za&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;http://www.distrotech.co.za&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">2013&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;/var/run/sockettest&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___l_i_b.html#ggaeee4d91155baa9a037ec7e965880ce1faeda13c7c877cf6c1a01100aa24811afc">FRAMEWORK_FLAG_DAEMONLOCK</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NULL&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the application under the library replacing main() </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="doxygen_2examples_2socket_8c.html#ad4d09807d002671ee7378fef2ee63a48" title="Initialise the application under the library replacing main() ">FRAMEWORK_MAIN()</a> </dd>
<dd>
<a class="el" href="group___l_i_b.html#gaec2d2872af6e5a3bc1d39f5837173023" title="Initilise application data structure and return a reference. ">framework_mkcore()</a> </dd>
<dd>
<a class="el" href="group___l_i_b.html#ga2cbddb1a87e905e7d016b74657758d4d" title="Initilise the application daemonise and join the manager thread. ">framework_init()</a></dd></dl>
<p>[main] </p>
<p>[main] </p>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a23">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00167">167</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="group___l_i_b.html#ga869452f0c0952acd39230fcf0ef89c1e">daemonize()</a>, <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest()</a>, and <a class="el" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;             :<span class="comment">//www.distrotech.co.za&quot;, 2013, &quot;/var/run/sockettest&quot;, FRAMEWORK_FLAG_DAEMONLOCK, NULL) {</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (argc &lt; 3) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#ifndef __WIN32</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Requires arguments %s [tcp|tls|udp|dtls|unix_d|unix_s] [ipaddr|socket]\n&quot;</span>, argv[0]);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Requires arguments %s [tcp|tls|udp|dtls] ipaddr\n&quot;</span>, argv[0]);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">return</span> (-1);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="group___l_i_b.html#ga869452f0c0952acd39230fcf0ef89c1e">daemonize</a>();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;udp&quot;</span>)) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a>(argv[2], 0, 0);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;dtls&quot;</span>)) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a>(argv[2], 0, 1);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;tcp&quot;</span>)) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a>(argv[2], 1, 0);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;tls&quot;</span>)) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a>(argv[2], 1, 1);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#ifndef __WIN32</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor"></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;unix_d&quot;</span>)) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest</a>(argv[2], SOCK_DGRAM);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;unix_s&quot;</span>)) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest</a>(argv[2], SOCK_STREAM);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor"></span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        printf(<span class="stringliteral">&quot;Invalid Option\n&quot;</span>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a5ef6ea6c5a4ecf30b10d8b4243f0e22a"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest</a></div><div class="ttdeci">void socktest(const char *ipaddr, int tcp, int ssl)</div><div class="ttdoc">Bassed on the options create server and clients. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00086">socket.c:86</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a9d9bd0957879771fdd9a4c74673aeff6"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest</a></div><div class="ttdeci">void unixsocktest(const char *socket, int protocol)</div><div class="ttdoc">Same test as for socktest() but for unix domain sockets. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00139">socket.c:139</a></div></div>
<div class="ttc" id="group___l_i_b_html_ga869452f0c0952acd39230fcf0ef89c1e"><div class="ttname"><a href="group___l_i_b.html#ga869452f0c0952acd39230fcf0ef89c1e">daemonize</a></div><div class="ttdeci">void daemonize()</div><div class="ttdoc">Daemonise the application using fork/exit. </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00094">main.c:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8acb206590ded63f9e7b4d53f86ee511"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_func </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfwsocket.html">fwsocket</a> *&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Server thread data is available. </p>
<p>This function executes when the server socket has data to read the socket will need to be read from using socketread[_d] socketread_d is a wrapper arround recvfrom and socketwerite_d is a wrapper arround sendto this is important when dealing with un encrypted UDP sessions where the socket needs sendto addresss to send data too. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>Reference to socket data is available on. </td></tr>
    <tr><td class="paramname">data</td><td>Reference to data held by thread. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a2">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00048">48</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">fwsocket::sock</a>, <a class="el" href="group___l_i_b-_sock.html#ga8dc9b8c4a861709be1b3fb2d105e5f8f">socketread_d()</a>, and <a class="el" href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d()</a>.</p>

<p>Referenced by <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a">socktest()</a>, and <a class="el" href="doxygen_2examples_2socket_8c.html#a9d9bd0957879771fdd9a4c74673aeff6">unixsocktest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                                    {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structzobj.html#a317b290945d079ccbe036e8c41c45668">buff</a>[128];</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">union </span><a class="code" href="unionsockstruct.html">sockstruct</a> addr;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___l_i_b-_sock.html#ga8dc9b8c4a861709be1b3fb2d105e5f8f">socketread_d</a>(sock, &amp;buff, 128, &amp;addr) &gt; 0) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d</a>(sock, &amp;buff, strlen(buff) + 1, &amp;addr);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        printf(<span class="stringliteral">&quot;[S] %s %i\n&quot;</span>, buff, sock-&gt;<a class="code" href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">sock</a>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        sleep(1);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="ttc" id="structfwsocket_html_aa08a6630d5f365c9d02702ae105d0508"><div class="ttname"><a href="structfwsocket.html#aa08a6630d5f365c9d02702ae105d0508">fwsocket::sock</a></div><div class="ttdeci">int sock</div><div class="ttdoc">Socket FD. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00133">dtsapp.h:133</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga8dc9b8c4a861709be1b3fb2d105e5f8f"><div class="ttname"><a href="group___l_i_b-_sock.html#ga8dc9b8c4a861709be1b3fb2d105e5f8f">socketread_d</a></div><div class="ttdeci">int socketread_d(struct fwsocket *sock, void *buf, int num, union sockstruct *addr)</div><div class="ttdoc">Read from a socket into a buffer. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00406">sslutil.c:406</a></div></div>
<div class="ttc" id="structzobj_html_a317b290945d079ccbe036e8c41c45668"><div class="ttname"><a href="structzobj.html#a317b290945d079ccbe036e8c41c45668">zobj::buff</a></div><div class="ttdeci">uint8_t * buff</div><div class="ttdoc">Buffer with compressed/uncompressed data. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00166">dtsapp.h:166</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga5243da7cf32d5d6e2c53489b1abaa5f3"><div class="ttname"><a href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d</a></div><div class="ttdeci">int socketwrite_d(struct fwsocket *sock, const void *buf, int num, union sockstruct *addr)</div><div class="ttdoc">Write a buffer to a socket. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00508">sslutil.c:508</a></div></div>
<div class="ttc" id="unionsockstruct_html"><div class="ttname"><a href="unionsockstruct.html">sockstruct</a></div><div class="ttdoc">Socket union describing all address types. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00080">dtsapp.h:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5ef6ea6c5a4ecf30b10d8b4243f0e22a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void socktest </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ipaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ssl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Bassed on the options create server and clients. </p>
<ul>
<li>If SSL / TLS was requested create SSL/TLS sessions to use. </li>
<li>Bind to server and connect the clients. </li>
<li>Start threads. </li>
<li>Send data to server. </li>
<li>Sleep</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ipaddr</td><td>As supplied on the command line </td></tr>
    <tr><td class="paramname">tcp</td><td>Set to non zero if using TCP. </td></tr>
    <tr><td class="paramname">ssl</td><td>Set to non zero if TLS/SSL is required. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a10">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00086">86</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="doxygen_2examples_2socket_8c.html#a1a392138c00ec1b59dfdeefe903da96f">accept_func()</a>, <a class="el" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func()</a>, <a class="el" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket()</a>, <a class="el" href="group___l_i_b-_sock-_s_s_l.html#gae19a9e715c6d93a87eb1250ced8a75ad">dtlsv1_init()</a>, <a class="el" href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func()</a>, <a class="el" href="group___l_i_b-_sock.html#gafcd84531c3e24e59c8fcaadd6f0f4fad">socketclient()</a>, <a class="el" href="group___l_i_b-_sock.html#ga4c08ae54e4e2d9ae7fa2f3a3a17a2e81">socketserver()</a>, <a class="el" href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite()</a>, <a class="el" href="group___l_i_b-_sock-_s_s_l.html#ga47c39c0837b68b9764f4d1f6035de273">sslv3_init()</a>, <a class="el" href="group___l_i_b-_sock.html#ga354c2cb8cea30bdfc4e436a659dfe705">tcpbind()</a>, <a class="el" href="group___l_i_b-_sock.html#gad404f20655be3c85448c64c0adf1b4c1">tcpconnect()</a>, <a class="el" href="group___l_i_b-_sock.html#ga5874588e183d143f2b42156a951087fe">udpbind()</a>, and <a class="el" href="group___l_i_b-_sock.html#gaa88a01b1562c34f48693ac606a1126e7">udpconnect()</a>.</p>

<p>Referenced by <a class="el" href="doxygen_2examples_2socket_8c.html#ad4d09807d002671ee7378fef2ee63a48">FRAMEWORK_MAIN()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                                    {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">struct </span><a class="code" href="structfwsocket.html">fwsocket</a> *serv, *client, *client2;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">void</span> *ssl_c = NULL, *ssl_s = NULL, *ssl_c2 = NULL;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">char</span> *buff = <span class="stringliteral">&quot;client 1&quot;</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">char</span> *buff2 = <span class="stringliteral">&quot;client 2&quot;</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordtype">int</span> cnt;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structfwsocket.html#ab503d2715edbc834777b1d16ba0594a6">ssl</a> &amp;&amp; tcp) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        ssl_s = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#ga47c39c0837b68b9764f4d1f6035de273">sslv3_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/server-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/server-key.pem&quot;</span>, SSL_VERIFY_PEER | SSL_VERIFY_CLIENT_ONCE);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        ssl_c = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#ga47c39c0837b68b9764f4d1f6035de273">sslv3_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-key.pem&quot;</span>, SSL_VERIFY_NONE);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        ssl_c2 = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#ga47c39c0837b68b9764f4d1f6035de273">sslv3_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-key.pem&quot;</span>, SSL_VERIFY_NONE);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structfwsocket.html#ab503d2715edbc834777b1d16ba0594a6">ssl</a>) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        ssl_s = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#gae19a9e715c6d93a87eb1250ced8a75ad">dtlsv1_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/server-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/server-key.pem&quot;</span>, SSL_VERIFY_PEER | SSL_VERIFY_CLIENT_ONCE);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        ssl_c = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#gae19a9e715c6d93a87eb1250ced8a75ad">dtlsv1_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-key.pem&quot;</span>, SSL_VERIFY_NONE);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        ssl_c2 = <a class="code" href="group___l_i_b-_sock-_s_s_l.html#gae19a9e715c6d93a87eb1250ced8a75ad">dtlsv1_init</a>(<span class="stringliteral">&quot;certs/cacert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-cert.pem&quot;</span>, <span class="stringliteral">&quot;certs/client-key.pem&quot;</span>, SSL_VERIFY_NONE);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (tcp) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        serv = <a class="code" href="group___l_i_b-_sock.html#ga354c2cb8cea30bdfc4e436a659dfe705">tcpbind</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_s, 10);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        client = <a class="code" href="group___l_i_b-_sock.html#gad404f20655be3c85448c64c0adf1b4c1">tcpconnect</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_c);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        client2 = <a class="code" href="group___l_i_b-_sock.html#gad404f20655be3c85448c64c0adf1b4c1">tcpconnect</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_c2);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        serv = <a class="code" href="group___l_i_b-_sock.html#ga5874588e183d143f2b42156a951087fe">udpbind</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_s);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        client = <a class="code" href="group___l_i_b-_sock.html#gaa88a01b1562c34f48693ac606a1126e7">udpconnect</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_c);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        client2 = <a class="code" href="group___l_i_b-_sock.html#gaa88a01b1562c34f48693ac606a1126e7">udpconnect</a>(ipaddr, <span class="stringliteral">&quot;1111&quot;</span>, ssl_c2);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (serv &amp;&amp; client &amp;&amp; client2) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#ga4c08ae54e4e2d9ae7fa2f3a3a17a2e81">socketserver</a>(serv, <a class="code" href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func</a>, <a class="code" href="doxygen_2examples_2socket_8c.html#a1a392138c00ec1b59dfdeefe903da96f">accept_func</a>, NULL, NULL);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#gafcd84531c3e24e59c8fcaadd6f0f4fad">socketclient</a>(client, NULL, <a class="code" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a>, NULL);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#gafcd84531c3e24e59c8fcaadd6f0f4fad">socketclient</a>(client2, NULL, <a class="code" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a>, NULL);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite</a>(client, buff, strlen(buff)+1);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="code" href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite</a>(client2, buff2, strlen(buff2)+1);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        sleep(5);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        printf(<span class="stringliteral">&quot;ERROR\n&quot;</span>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(client);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(client2);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(serv);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
<div class="ttc" id="group___l_i_b-_sock-_s_s_l_html_ga47c39c0837b68b9764f4d1f6035de273"><div class="ttname"><a href="group___l_i_b-_sock-_s_s_l.html#ga47c39c0837b68b9764f4d1f6035de273">sslv3_init</a></div><div class="ttdeci">void * sslv3_init(const char *cacert, const char *cert, const char *key, int verify)</div><div class="ttdoc">Create a SSL structure for SSLv3. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00311">sslutil.c:311</a></div></div>
<div class="ttc" id="structfwsocket_html"><div class="ttname"><a href="structfwsocket.html">fwsocket</a></div><div class="ttdoc">Socket data structure. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00131">dtsapp.h:131</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a8acb206590ded63f9e7b4d53f86ee511"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func</a></div><div class="ttdeci">void server_func(struct fwsocket *sock, void *data)</div><div class="ttdoc">Server thread data is available. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00048">socket.c:48</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga354c2cb8cea30bdfc4e436a659dfe705"><div class="ttname"><a href="group___l_i_b-_sock.html#ga354c2cb8cea30bdfc4e436a659dfe705">tcpbind</a></div><div class="ttdeci">struct fwsocket * tcpbind(const char *ipaddr, const char *port, void *ssl, int backlog)</div><div class="ttdoc">Generic server socket. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00315">socket.c:315</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga083df40554507cfc277fb699c10a17ec"><div class="ttname"><a href="group___l_i_b-_sock.html#ga083df40554507cfc277fb699c10a17ec">socketwrite</a></div><div class="ttdeci">int socketwrite(struct fwsocket *sock, const void *buf, int num)</div><div class="ttdoc">Write a buffer to a socket. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00629">sslutil.c:629</a></div></div>
<div class="ttc" id="group___l_i_b-_sock-_s_s_l_html_gae19a9e715c6d93a87eb1250ced8a75ad"><div class="ttname"><a href="group___l_i_b-_sock-_s_s_l.html#gae19a9e715c6d93a87eb1250ced8a75ad">dtlsv1_init</a></div><div class="ttdeci">void * dtlsv1_init(const char *cacert, const char *cert, const char *key, int verify)</div><div class="ttdoc">Create a SSL structure for DTLSv1. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00325">sslutil.c:325</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_gae2172d725d57ad6446229c480f907dc7"><div class="ttname"><a href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a></div><div class="ttdeci">void close_socket(struct fwsocket *sock)</div><div class="ttdoc">Mark the socket for closure and release the reference. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00079">socket.c:79</a></div></div>
<div class="ttc" id="structfwsocket_html_ab503d2715edbc834777b1d16ba0594a6"><div class="ttname"><a href="structfwsocket.html#ab503d2715edbc834777b1d16ba0594a6">fwsocket::ssl</a></div><div class="ttdeci">struct ssldata * ssl</div><div class="ttdoc">SSL structure for encryption. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00146">dtsapp.h:146</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_gaa88a01b1562c34f48693ac606a1126e7"><div class="ttname"><a href="group___l_i_b-_sock.html#gaa88a01b1562c34f48693ac606a1126e7">udpconnect</a></div><div class="ttdeci">struct fwsocket * udpconnect(const char *ipaddr, const char *port, void *ssl)</div><div class="ttdoc">UDP Socket client. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00262">socket.c:262</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a1a392138c00ec1b59dfdeefe903da96f"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a1a392138c00ec1b59dfdeefe903da96f">accept_func</a></div><div class="ttdeci">void accept_func(struct fwsocket *sock, void *data)</div><div class="ttdoc">This function does nothing and is here for completeness. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00036">socket.c:36</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga4c08ae54e4e2d9ae7fa2f3a3a17a2e81"><div class="ttname"><a href="group___l_i_b-_sock.html#ga4c08ae54e4e2d9ae7fa2f3a3a17a2e81">socketserver</a></div><div class="ttdeci">void socketserver(struct fwsocket *sock, socketrecv connectfunc, socketrecv acceptfunc, threadcleanup cleanup, void *data)</div><div class="ttdoc">Create a server thread with a socket that has been created with sockbind udpbind or tcpbind...</div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00463">socket.c:463</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga5874588e183d143f2b42156a951087fe"><div class="ttname"><a href="group___l_i_b-_sock.html#ga5874588e183d143f2b42156a951087fe">udpbind</a></div><div class="ttdeci">struct fwsocket * udpbind(const char *ipaddr, const char *port, void *ssl)</div><div class="ttdoc">UDP server socket. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00302">socket.c:302</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_gafcd84531c3e24e59c8fcaadd6f0f4fad"><div class="ttname"><a href="group___l_i_b-_sock.html#gafcd84531c3e24e59c8fcaadd6f0f4fad">socketclient</a></div><div class="ttdeci">void socketclient(struct fwsocket *sock, void *data, socketrecv read, threadcleanup cleanup)</div><div class="ttdoc">Create a server thread with a socket that has been created with sockbind udpbind or tcpbind...</div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00493">socket.c:493</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a31a3fbb9110bf3db1a75cedc9b83f1f5"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a></div><div class="ttdeci">void client_func(struct fwsocket *sock, void *data)</div><div class="ttdoc">client thread data is available. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00066">socket.c:66</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_gad404f20655be3c85448c64c0adf1b4c1"><div class="ttname"><a href="group___l_i_b-_sock.html#gad404f20655be3c85448c64c0adf1b4c1">tcpconnect</a></div><div class="ttdeci">struct fwsocket * tcpconnect(const char *ipaddr, const char *port, void *ssl)</div><div class="ttdoc">TCP Socket client. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00274">socket.c:274</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d9bd0957879771fdd9a4c74673aeff6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unixsocktest </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>protocol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Same test as for <a class="el" href="doxygen_2examples_2socket_8c.html#a5ef6ea6c5a4ecf30b10d8b4243f0e22a" title="Bassed on the options create server and clients. ">socktest()</a> but for unix domain sockets. </p>
<p>Unix domain sockets are "file" sockets and function in similar way to network sockets there scope is local to the machine so are often used for inter process control and networkless services. Instead of a IP address a file name is specified that is created by the server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>File name to create server on and connect too. </td></tr>
    <tr><td class="paramname">protocol</td><td>Theis is either SOCK_STREAM or SOCK_DGRAM and are similar to TCP/UDP respectivly. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="socket_8c-example.html#a20">socket.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="doxygen_2examples_2socket_8c_source.html#l00139">139</a> of file <a class="el" href="doxygen_2examples_2socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func()</a>, <a class="el" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket()</a>, <a class="el" href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func()</a>, <a class="el" href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d()</a>, <a class="el" href="group___l_i_b-_sock-_unix.html#gac55bd1419f27dce6b1b8ccd5e6490d12">unixsocket_client()</a>, and <a class="el" href="group___l_i_b-_sock-_unix.html#ga9fe98a54d1e9ab578c98b109a3971900">unixsocket_server()</a>.</p>

<p>Referenced by <a class="el" href="doxygen_2examples_2socket_8c.html#ad4d09807d002671ee7378fef2ee63a48">FRAMEWORK_MAIN()</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                    {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordtype">char</span> *buff = <span class="stringliteral">&quot;client 1&quot;</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">char</span> *buff2 = <span class="stringliteral">&quot;client 2&quot;</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">struct </span><a class="code" href="structfwsocket.html">fwsocket</a> *client, *client2, *server;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    server = <a class="code" href="group___l_i_b-_sock-_unix.html#ga9fe98a54d1e9ab578c98b109a3971900">unixsocket_server</a>(socket, protocol, S_IXUSR | S_IWGRP | S_IRGRP | S_IXGRP | S_IWOTH | S_IROTH | S_IXOTH, <a class="code" href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func</a>, NULL);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    sleep(1); <span class="comment">/*wait for socket*/</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    client = <a class="code" href="group___l_i_b-_sock-_unix.html#gac55bd1419f27dce6b1b8ccd5e6490d12">unixsocket_client</a>(socket, protocol, <a class="code" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a>, NULL);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    client2 = <a class="code" href="group___l_i_b-_sock-_unix.html#gac55bd1419f27dce6b1b8ccd5e6490d12">unixsocket_client</a>(socket, protocol, <a class="code" href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a>, NULL);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d</a>(client, buff, strlen(buff)+1, NULL);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d</a>(client2, buff2, strlen(buff2)+1, NULL);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    sleep(5);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(client);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(client2);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a>(server);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
<div class="ttc" id="group___l_i_b-_sock-_unix_html_gac55bd1419f27dce6b1b8ccd5e6490d12"><div class="ttname"><a href="group___l_i_b-_sock-_unix.html#gac55bd1419f27dce6b1b8ccd5e6490d12">unixsocket_client</a></div><div class="ttdeci">struct fwsocket * unixsocket_client(const char *sock, int protocol, socketrecv read, void *data)</div><div class="ttdoc">Create a client thread on the socket. </div><div class="ttdef"><b>Definition:</b> <a href="unixsock_8c_source.html#l00310">unixsock.c:310</a></div></div>
<div class="ttc" id="structfwsocket_html"><div class="ttname"><a href="structfwsocket.html">fwsocket</a></div><div class="ttdoc">Socket data structure. </div><div class="ttdef"><b>Definition:</b> <a href="dtsapp_8h_source.html#l00131">dtsapp.h:131</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a8acb206590ded63f9e7b4d53f86ee511"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a8acb206590ded63f9e7b4d53f86ee511">server_func</a></div><div class="ttdeci">void server_func(struct fwsocket *sock, void *data)</div><div class="ttdoc">Server thread data is available. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00048">socket.c:48</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_gae2172d725d57ad6446229c480f907dc7"><div class="ttname"><a href="group___l_i_b-_sock.html#gae2172d725d57ad6446229c480f907dc7">close_socket</a></div><div class="ttdeci">void close_socket(struct fwsocket *sock)</div><div class="ttdoc">Mark the socket for closure and release the reference. </div><div class="ttdef"><b>Definition:</b> <a href="src_2socket_8c_source.html#l00079">socket.c:79</a></div></div>
<div class="ttc" id="group___l_i_b-_sock_html_ga5243da7cf32d5d6e2c53489b1abaa5f3"><div class="ttname"><a href="group___l_i_b-_sock.html#ga5243da7cf32d5d6e2c53489b1abaa5f3">socketwrite_d</a></div><div class="ttdeci">int socketwrite_d(struct fwsocket *sock, const void *buf, int num, union sockstruct *addr)</div><div class="ttdoc">Write a buffer to a socket. </div><div class="ttdef"><b>Definition:</b> <a href="sslutil_8c_source.html#l00508">sslutil.c:508</a></div></div>
<div class="ttc" id="doxygen_2examples_2socket_8c_html_a31a3fbb9110bf3db1a75cedc9b83f1f5"><div class="ttname"><a href="doxygen_2examples_2socket_8c.html#a31a3fbb9110bf3db1a75cedc9b83f1f5">client_func</a></div><div class="ttdeci">void client_func(struct fwsocket *sock, void *data)</div><div class="ttdoc">client thread data is available. </div><div class="ttdef"><b>Definition:</b> <a href="doxygen_2examples_2socket_8c_source.html#l00066">socket.c:66</a></div></div>
<div class="ttc" id="group___l_i_b-_sock-_unix_html_ga9fe98a54d1e9ab578c98b109a3971900"><div class="ttname"><a href="group___l_i_b-_sock-_unix.html#ga9fe98a54d1e9ab578c98b109a3971900">unixsocket_server</a></div><div class="ttdeci">struct fwsocket * unixsocket_server(const char *sock, int protocol, int mask, socketrecv read, void *data)</div><div class="ttdoc">Create and run UNIX server socket thread. </div><div class="ttdef"><b>Definition:</b> <a href="unixsock_8c_source.html#l00277">unixsock.c:277</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4e8d938e9ddb5a617c200d5739d1f41a.html">doxygen</a></li><li class="navelem"><a class="el" href="dir_0c6655e7a474ec7aa2f43d8d56b9e1c1.html">examples</a></li><li class="navelem"><a class="el" href="doxygen_2examples_2socket_8c.html">socket.c</a></li>
    <li class="footer">Generated on Wed Oct 23 2013 10:44:29 for DTS Application Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
